import unittest

from run_leo import Account
from run_leo.core import import_leo_program


class TestBasicBank(unittest.TestCase):
    def test_load_leo_program(self):
        bb = import_leo_program('./leo_examples/basic_bank')()

        # Test if structs/records are successfully converted to class variables
        self.assertTrue(hasattr(bb, "Token"))

        # Test if functions are successfully converted to class methods
        self.assertTrue(hasattr(bb, "issue"))
        self.assertTrue(hasattr(bb, "deposit"))
        self.assertTrue(hasattr(bb, 'withdraw'))

        # create bank and user account
        bank = Account(address='aleo1t0uer3jgtsgmx5tq6x6f9ecu8tr57rzzfnc2dgmcqldceal0ls9qf6st7a',
                       private_key='APrivateKey1zkpHtqVWT6fSHgUMNxsuVf7eaR6id2cj7TieKY1Z8CP5rCD')
        user = Account(address='aleo1zeklp6dd8e764spe74xez6f8w27dlua3w7hl4z2uln03re52egpsv46ngg',
                       private_key='APrivateKey1zkp75cpr5NNQpVWc5mfsD9Uf2wg6XvHknf82iwB636q3rtc')

        # Test leo method calls
        print("""
###############################################################################
########                                                               ########
########     STEP 1: Initialize 100 tokens for aleo1zeklp...v46ngg     ########
########                                                               ########
########           -----------------------------------------           ########
########           |      ACTION     |        AMOUNT       |           ########
########           -----------------------------------------           ########
########           -----------------------------------------           ########
########           |        Issuing  |         100         |           ########
########           -----------------------------------------           ########
########           |     Depositing  |          0          |           ########
########           -----------------------------------------           ########
########           |    Withdrawing  |          0          |           ########
########           -----------------------------------------           ########
########                                                               ########
########           -----------------------------------------           ########
########           |      WALLET     | aleo1zeklp...v46ngg |           ########
########           -----------------------------------------           ########
########           -----------------------------------------           ########
########           |        Balance  |         100         |           ########
########           -----------------------------------------           ########
########                                                               ########
########           -----------------------------------------           ########
########           |      BANK       | aleo1zeklp...v46ngg |           ########
########           -----------------------------------------           ########
########           -----------------------------------------           ########
########           |        Balance  |          0          |           ########
########           -----------------------------------------           ########
########           |        Periods  |          0          |           ########
########           -----------------------------------------           ########
########           |  Interest Rate  |        12.34%       |           ########
########           -----------------------------------------           ########
########                                                               ########
########           -----------------------------------------           ########
########           |  TOTAL BALANCE  |         100         |           ########
########           -----------------------------------------           ########
########                                                               ########
###############################################################################
""")
        bb.set_account(bank)
        token = bb.issue(user.address, 100)
        print(token)

        print("""
###############################################################################
########                                                               ########
########     STEP 2: aleo1zeklp...v46ngg deposits 50 tokens            ########
########                                                               ########
########           -----------------------------------------           ########
########           |      ACTION     |        AMOUNT       |           ########
########           -----------------------------------------           ########
########           -----------------------------------------           ########
########           |        Issuing  |          0          |           ########
########           -----------------------------------------           ########
########           |     Depositing  |          50         |           ########
########           -----------------------------------------           ########
########           |    Withdrawing  |          0          |           ########
########           -----------------------------------------           ########
########                                                               ########
########           -----------------------------------------           ########
########           |      WALLET     | aleo1zeklp...v46ngg |           ########
########           -----------------------------------------           ########
########           -----------------------------------------           ########
########           |        Balance  |          50         |           ########
########           -----------------------------------------           ########
########                                                               ########
########           -----------------------------------------           ########
########           |      BANK       | aleo1zeklp...v46ngg |           ########
########           -----------------------------------------           ########
########           -----------------------------------------           ########
########           |        Balance  |          50         |           ########
########           -----------------------------------------           ########
########           |        Periods  |          0          |           ########
########           -----------------------------------------           ########
########           |  Interest Rate  |        12.34%       |           ########
########           -----------------------------------------           ########
########                                                               ########
########           -----------------------------------------           ########
########           |  TOTAL BALANCE  |         100         |           ########
########           -----------------------------------------           ########
########                                                               ########
###############################################################################
""")
        bb.set_account(user)
        token = bb.deposit(token, 50)
        print(token)

        # Have the bank withdraw all of the user's tokens with compound interest over 15 periods at 12.34%.
        print("""
###############################################################################
########                                                               ########
########     STEP 3: Wait 15 periods                                   ########
########                                                               ########
########           -----------------------------------------           ########
########           |      ACTION     |        AMOUNT       |           ########
########           -----------------------------------------           ########
########           -----------------------------------------           ########
########           |        Issuing  |          0          |           ########
########           -----------------------------------------           ########
########           |     Depositing  |          0          |           ########
########           -----------------------------------------           ########
########           |    Withdrawing  |          0          |           ########
########           -----------------------------------------           ########
########                                                               ########
########           -----------------------------------------           ########
########           |      WALLET     | aleo1zeklp...v46ngg |           ########
########           -----------------------------------------           ########
########           -----------------------------------------           ########
########           |        Balance  |          50         |           ########
########           -----------------------------------------           ########
########                                                               ########
########           -----------------------------------------           ########
########           |      BANK       | aleo1zeklp...v46ngg |           ########
########           -----------------------------------------           ########
########           -----------------------------------------           ########
########           |        Balance  |         266         |           ########
########           -----------------------------------------           ########
########           |        Periods  |          15         |           ########
########           -----------------------------------------           ########
########           |  Interest Rate  |        12.34%       |           ########
########           -----------------------------------------           ########
########                                                               ########
########           -----------------------------------------           ########
########           |  TOTAL BALANCE  |         316         |           ########
########           -----------------------------------------           ########
########                                                               ########
###############################################################################
""")
        print("""
###############################################################################
########                                                               ########
########  STEP 4: Withdraw tokens of aleo1zeklp...v46ngg w/ interest   ########
########                                                               ########
########           -----------------------------------------           ########
########           |      ACTION     |        AMOUNT       |           ########
########           -----------------------------------------           ########
########           -----------------------------------------           ########
########           |        Issuing  |          0          |           ########
########           -----------------------------------------           ########
########           |     Depositing  |          0          |           ########
########           -----------------------------------------           ########
########           |    Withdrawing  |         266         |           ########
########           -----------------------------------------           ########
########                                                               ########
########           -----------------------------------------           ########
########           |      WALLET     | aleo1zeklp...v46ngg |           ########
########           -----------------------------------------           ########
########           -----------------------------------------           ########
########           |        Balance  |         316         |           ########
########           -----------------------------------------           ########
########                                                               ########
########           -----------------------------------------           ########
########           |      BANK       | aleo1zeklp...v46ngg |           ########
########           -----------------------------------------           ########
########           -----------------------------------------           ########
########           |        Balance  |          0          |           ########
########           -----------------------------------------           ########
########           |        Periods  |          15         |           ########
########           -----------------------------------------           ########
########           |  Interest Rate  |        12.34%       |           ########
########           -----------------------------------------           ########
########                                                               ########
########           -----------------------------------------           ########
########           |  TOTAL BALANCE  |         316         |           ########
########           -----------------------------------------           ########
########                                                               ########
###############################################################################
""")
        bb.set_account(bank)
        token = bb.withdraw(user.address, 50, 1234, 15)
        print(token)


if __name__ == '__main__':
    unittest.main()
